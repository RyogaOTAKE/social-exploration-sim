(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=600,t=600,n=function(e){return e[e.HOME=0]=`HOME`,e[e.FOOD=1]=`FOOD`,e}(n||{}),r=function(e){return e[e.FORAGING=0]=`FORAGING`,e[e.RETURNING=1]=`RETURNING`,e[e.HARVESTING=2]=`HARVESTING`,e}(r||{}),i={agentCount:500,moveSpeed:1.5,evapRateHome:.995,evapRateFood:.95,sensorAngle:Math.PI/4,sensorDist:20,turnSpeed:.2,nestCount:1,foodCount:2,singlePheromoneMode:!0,uTurnChance:.01,excitedSpeedMult:2,propagationChance:.1,excitedDecayRate:.01,usePheromoneGradient:!0,explorationResistance:0,excitedTurnSpeedMult:3,spawnRate:5,enableSortieRegulation:!1,enableGiveUp:!1,enableTunnels:!1,enableHarvestTime:!1},a=[],o=[];function s(){o=[];for(let n=0;n<i.foodCount;n++){let n,r=0;do n={x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:30,surgeTimer:0},r++;while(u(n.x,n.y,n.r)&&r<100);o.push(n)}}function c(){a=[];for(let n=0;n<i.nestCount;n++){let r,i=0;do r=n===0&&i===0?{x:e/2,y:t/2,r:20,surgeTimer:0}:{x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:20,surgeTimer:0},i++;while(u(r.x,r.y,r.r)&&i<100);a.push(r)}}var l=[];function u(e,t,n){for(let r of l)if(e+n>r.x&&e-n<r.x+r.w&&t+n>r.y&&t-n<r.y+r.h)return!0;return!1}function d(){l=[];let n=Math.floor(e/60),r=Math.floor(t/60);l.push({x:0,y:0,w:e,h:10}),l.push({x:0,y:t-10,w:e,h:10}),l.push({x:0,y:0,w:10,h:t}),l.push({x:e-10,y:0,w:10,h:t});for(let e=2;e<r-1;e+=2)for(let t=2;t<n-1;t+=2){let n=t*60,r=e*60;switch(l.push({x:n,y:r,w:10,h:10}),Math.floor(Math.random()*4)){case 0:l.push({x:n,y:r-60,w:10,h:60});break;case 1:l.push({x:n,y:r,w:10,h:60});break;case 2:l.push({x:n-60,y:r,w:60,h:10});break;case 3:l.push({x:n,y:r,w:60,h:10});break}}}var f=class{width;height;homeGrid;foodGrid;tunnelGrid;constructor(e,t){this.width=e,this.height=t,this.homeGrid=new Float32Array(e*t),this.foodGrid=new Float32Array(e*t),this.tunnelGrid=new Float32Array(e*t)}deposit(e,t,r,a){let o=Math.floor(t)*this.width+Math.floor(e);o>=0&&o<this.homeGrid.length&&((i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[o]=Math.min(1,this.homeGrid[o]+a):this.foodGrid[o]=Math.min(1,this.foodGrid[o]+a))}depositTunnel(e,t,n){let r=Math.floor(t)*this.width+Math.floor(e);r>=0&&r<this.tunnelGrid.length&&(this.tunnelGrid[r]=Math.min(1,this.tunnelGrid[r]+n))}getTunnelLevel(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return 0;let n=Math.floor(t)*this.width+Math.floor(e);return this.tunnelGrid[n]}getLevel(e,t,r){if(e<0||e>=this.width||t<0||t>=this.height)return-1;let a=Math.floor(t)*this.width+Math.floor(e);return(i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[a]:this.foodGrid[a]}evaporate(e,t){for(let n=0;n<this.homeGrid.length;n++)this.homeGrid[n]*=e,this.foodGrid[n]*=t,this.homeGrid[n]<.001&&(this.homeGrid[n]=0),this.foodGrid[n]<.001&&(this.foodGrid[n]=0)}reset(){this.homeGrid.fill(0),this.foodGrid.fill(0),this.tunnelGrid.fill(0)}},p=class{x;y;angle;state;pheromoneStrength;excitedLevel;searchTime;givingUp;harvestTimer;constructor(e,t){this.x=e,this.y=t,this.angle=Math.random()*Math.PI*2,this.state=r.FORAGING,this.pheromoneStrength=1,this.excitedLevel=0,this.searchTime=0,this.givingUp=!1,this.harvestTimer=0}update(e,t){if(this.excitedLevel>0&&i.excitedDecayRate>0&&Math.random()<i.excitedDecayRate&&(this.excitedLevel=0),i.propagationChance>0&&this.excitedLevel===0){for(let e of t)if(e!==this&&e.excitedLevel===2&&Math.random()<i.propagationChance){this.excitedLevel=1;break}}if(this.sense(e),i.enableGiveUp&&this.state===r.FORAGING&&this.excitedLevel===0){let t=e.getLevel(this.x,this.y,n.HOME),r=e.getLevel(this.x,this.y,n.FOOD);t>.05||r>.05?(this.searchTime=0,this.givingUp=!1):(this.searchTime++,this.searchTime>900&&(this.givingUp=!0))}let a=this.excitedLevel>0?.05:.2;this.angle+=(Math.random()-.5)*a;let o=i.moveSpeed*(this.excitedLevel>0?i.excitedSpeedMult:1);if(this.state===r.HARVESTING)o=0;else if(i.enableTunnels&&(e.depositTunnel(this.x,this.y,.005),e.getTunnelLevel(this.x,this.y)>.1&&(o*=1.2)),i.explorationResistance>0){let t=Math.max(e.getLevel(this.x,this.y,n.HOME),e.getLevel(this.x,this.y,n.FOOD)),r=1-i.explorationResistance*(1-t);o*=Math.max(0,r)}let s=this.x,c=this.y;this.x+=Math.cos(this.angle)*o,this.y+=Math.sin(this.angle)*o,this.handleObstacles(s,c),this.handleBoundaries(e),this.handleStateAndPheromones(e)}handleObstacles(e,t){for(let n of l)if(this.x>=n.x&&this.x<=n.x+n.w&&this.y>=n.y&&this.y<=n.y+n.h){this.x=e,this.y=t,this.angle+=Math.PI+(Math.random()-.5);return}}sense(e){if(this.givingUp){this.senseAnyPheromone(e);return}let t=this.state===r.FORAGING?n.FOOD:n.HOME,a=this.angle-i.sensorAngle,o=this.angle+i.sensorAngle,s=e=>({x:this.x+Math.cos(e)*i.sensorDist,y:this.y+Math.sin(e)*i.sensorDist}),c=s(a),l=s(this.angle),u=s(o),d=i.enableTunnels?.5:0,f=n=>e.getLevel(n.x,n.y,t)+(i.enableTunnels?e.getTunnelLevel(n.x,n.y)*d:0),p=f(c),m=f(l),h=f(u),g=i.turnSpeed;if(this.excitedLevel>0&&(g*=i.excitedTurnSpeedMult),m>p&&m>h||(m<p&&m<h?this.angle+=(Math.random()-.5)*2*g:p>h?this.angle-=g:h>p&&(this.angle+=g)),i.uTurnChance>0){let e=Math.random()<i.uTurnChance;m+Math.max(p,h)<.05&&Math.random()<i.uTurnChance*10&&(e=!0),e&&(this.angle+=Math.PI)}}senseAnyPheromone(e){let t=this.angle-i.sensorAngle,r=this.angle+i.sensorAngle,a=e=>({x:this.x+Math.cos(e)*i.sensorDist,y:this.y+Math.sin(e)*i.sensorDist}),o=a(t),s=a(this.angle),c=a(r),l=(t,r)=>e.getLevel(t,r,n.HOME)+e.getLevel(t,r,n.FOOD)+(i.enableTunnels?e.getTunnelLevel(t,r):0),u=l(o.x,o.y),d=l(s.x,s.y),f=l(c.x,c.y),p=i.turnSpeed*2;d>u&&d>f||(d<u&&d<f?this.angle+=(Math.random()-.5)*2*p:u>f?this.angle-=p:f>u&&(this.angle+=p)),d+u+f<.01&&Math.random()<.05&&(this.angle+=(Math.random()-.5)*Math.PI)}handleBoundaries(e){this.x<0&&(this.x=0,this.angle=Math.PI-this.angle),this.x>=e.width&&(this.x=e.width-1,this.angle=Math.PI-this.angle),this.y<0&&(this.y=0,this.angle=-this.angle),this.y>=e.height&&(this.y=e.height-1,this.angle=-this.angle)}handleStateAndPheromones(e){let t=a[0],s=1/0;for(let e of a){let n=Math.hypot(this.x-e.x,this.y-e.y);n<s&&(s=n,t=e)}let c=s,l=t.r,u=!1;for(let e of o)if(Math.hypot(this.x-e.x,this.y-e.y)<e.r){u=!0;break}let d=.1;this.state===r.FORAGING&&(d=this.pheromoneStrength),e.deposit(this.x,this.y,n.HOME,d),this.state===r.RETURNING?e.deposit(this.x,this.y,n.FOOD,this.pheromoneStrength):this.excitedLevel>0&&e.deposit(this.x,this.y,n.FOOD,1),this.state===r.FORAGING?(u?i.enableHarvestTime?(this.state=r.HARVESTING,this.harvestTimer=60+Math.random()*120):(this.state=r.RETURNING,this.pheromoneStrength=1,this.angle+=Math.PI,this.excitedLevel=2):i.usePheromoneGradient?this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005):this.pheromoneStrength=1,c<l&&(this.pheromoneStrength=1)):this.state===r.HARVESTING?(this.harvestTimer--,this.pheromoneStrength=1,this.harvestTimer<=0&&(this.state=r.RETURNING,this.pheromoneStrength=1,this.angle+=Math.PI,this.excitedLevel=2)):(c<l?(this.state===r.RETURNING&&this.excitedLevel===2&&(t.surgeTimer=600),this.state=r.FORAGING,this.pheromoneStrength=1,this.angle+=Math.PI,this.excitedLevel=0):i.usePheromoneGradient?this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005):this.pheromoneStrength=1,u&&(this.pheromoneStrength=1))}},m=document.getElementById(`simCanvas`).getContext(`2d`,{alpha:!1}),h=document.getElementById(`densityCanvas`).getContext(`2d`,{alpha:!1}),g=document.getElementById(`stat-total`),_=document.getElementById(`stat-foraging`),v=document.getElementById(`stat-returning`),y=document.getElementById(`stat-excited2`),b=document.getElementById(`stat-excited1`),x=new f(e,t),S=[],C=0;function w(){S=[],C=0}function T(){let e=(e,t,n=!1)=>{let r=document.getElementById(e),a=document.getElementById(`val-${e}`);r.addEventListener(`input`,()=>{let e=n?parseFloat(r.value):parseInt(r.value);i[t]=e,a.textContent=String(e),t===`agentCount`&&(w(),x.reset())})};e(`agentCount`,`agentCount`),e(`spawnRate`,`spawnRate`,!0),e(`moveSpeed`,`moveSpeed`,!0),e(`evapRateHome`,`evapRateHome`,!0),e(`evapRateFood`,`evapRateFood`,!0),e(`sensorAngle`,`sensorAngle`,!1);let t=document.getElementById(`sensorAngle`),n=document.getElementById(`val-sensorAngle`);t.addEventListener(`input`,()=>{let e=parseFloat(t.value);i.sensorAngle=e*(Math.PI/180),n.textContent=String(e)}),e(`sensorDist`,`sensorDist`,!0),e(`uTurnChance`,`uTurnChance`,!0),e(`excitedSpeedMult`,`excitedSpeedMult`,!0),e(`propagationChance`,`propagationChance`,!0),e(`excitedDecayRate`,`excitedDecayRate`,!0),e(`explorationResistance`,`explorationResistance`,!0),e(`excitedTurnSpeedMult`,`excitedTurnSpeedMult`,!0),e(`nestCount`,`nestCount`,!1),document.getElementById(`nestCount`)?.addEventListener(`input`,()=>{c(),w(),x.reset()}),e(`foodCount`,`foodCount`,!1),document.getElementById(`foodCount`)?.addEventListener(`input`,()=>{s(),x.reset(),w()});let r=document.getElementById(`singlePheromoneMode`);r&&r.addEventListener(`change`,()=>{i.singlePheromoneMode=r.checked,x.reset(),w()});let a=document.getElementById(`usePheromoneGradient`);a&&a.addEventListener(`change`,()=>{i.usePheromoneGradient=a.checked,x.reset(),w()});let o=document.getElementById(`enableSortieRegulation`);o&&o.addEventListener(`change`,()=>{i.enableSortieRegulation=o.checked});let u=document.getElementById(`enableGiveUp`);u&&u.addEventListener(`change`,()=>{i.enableGiveUp=u.checked});let f=document.getElementById(`enableTunnels`);f&&f.addEventListener(`change`,()=>{i.enableTunnels=f.checked});let p=document.getElementById(`enableHarvestTime`);p&&p.addEventListener(`change`,()=>{i.enableHarvestTime=p.checked}),document.getElementById(`mazeBtn`)?.addEventListener(`click`,()=>{d(),x.reset(),c(),s(),w()}),document.getElementById(`clearMazeBtn`)?.addEventListener(`click`,()=>{l=[],x.reset(),c(),s(),w()}),document.getElementById(`resetBtn`)?.addEventListener(`click`,()=>{x.reset(),c(),s(),w()})}function E(){for(let e of a)e.surgeTimer>0&&e.surgeTimer--;if(S.length<i.agentCount){C+=i.spawnRate;let e=Math.floor(C);C-=e;for(let t=0;t<e&&!(S.length>=i.agentCount);t++){let e=a[Math.floor(Math.random()*a.length)];i.enableSortieRegulation&&!(e.surgeTimer>0)&&Math.random()>.01||S.push(new p(e.x,e.y))}}x.evaporate(i.evapRateHome,i.evapRateFood);let n=Math.ceil(e/10),s=new Map;for(let e of S){let t=Math.floor(e.x/10),r=Math.floor(e.y/10)*n+t;s.has(r)||s.set(r,[]),s.get(r).push(e)}for(let e of S){let t=Math.floor(e.x/10),r=Math.floor(e.y/10)*n+t,i=s.get(r)||[];e.update(x,i)}h.fillStyle=`black`,h.fillRect(0,0,e,t);for(let[e,t]of s.entries()){let r=t.length;if(r===0)continue;let i=e%n,a=Math.floor(e/n);h.fillStyle=`hsla(${240*(1-Math.min(1,r/5))}, 100%, 50%, 0.6)`,h.fillRect(i*10,a*10,10,10)}let c=m.getImageData(0,0,e,t),u=c.data;for(let e=0;e<x.homeGrid.length;e++){let t=x.homeGrid[e],n=x.foodGrid[e],r=x.tunnelGrid[e],i=e*4,a=n*255*2,o=(t+n)*30,s=t*255*2;r>0&&(a+=r*120,o+=r*80,s+=r*40),u[i]=Math.min(255,a),u[i+1]=Math.min(255,o),u[i+2]=Math.min(255,s),u[i+3]=255}for(let t of S){let n=Math.floor(t.x),r=(Math.floor(t.y)*e+n)*4;r>=0&&r<u.length&&(t.excitedLevel===2?(u[r]=255,u[r+1]=150,u[r+2]=50):t.excitedLevel===1?(u[r]=255,u[r+1]=255,u[r+2]=100):(u[r]=255,u[r+1]=255,u[r+2]=255),u[r+3]=255)}m.putImageData(c,0,0),m.strokeStyle=`rgba(100, 100, 255, 0.5)`,m.lineWidth=2;for(let e of a)m.beginPath(),m.arc(e.x,e.y,e.r,0,Math.PI*2),m.stroke();m.strokeStyle=`rgba(255, 100, 100, 0.5)`;for(let e of o)m.beginPath(),m.arc(e.x,e.y,e.r,0,Math.PI*2),m.stroke();m.fillStyle=`#888`;for(let e of l)m.fillRect(e.x,e.y,e.w,e.h);let d=0,f=0,w=0,T=0;for(let e of S)e.state===r.FORAGING?d++:f++,e.excitedLevel===2?w++:e.excitedLevel===1&&T++;g&&(g.textContent=String(S.length)),_&&(_.textContent=String(d)),v&&(v.textContent=String(f)),y&&(y.textContent=String(w)),b&&(b.textContent=String(T)),requestAnimationFrame(E)}T(),c(),s(),w();var D=document.getElementById(`sensorAngle`);i.sensorAngle=parseFloat(D.value)*(Math.PI/180),E();