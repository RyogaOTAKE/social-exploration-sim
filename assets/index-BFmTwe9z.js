(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=600,t=600,n=function(e){return e[e.HOME=0]=`HOME`,e[e.FOOD=1]=`FOOD`,e}(n||{}),r=function(e){return e[e.FORAGING=0]=`FORAGING`,e[e.RETURNING=1]=`RETURNING`,e}(r||{}),i={agentCount:500,moveSpeed:1.5,evaporationRate:.985,sensorAngle:Math.PI/4,sensorDist:20,turnSpeed:.2,nestCount:1,foodCount:2,singlePheromoneMode:!0,uTurnChance:.01,excitedSpeedMult:2,propagationChance:.1,excitedDecayRate:.01,usePheromoneGradient:!0,explorationResistance:0,excitedTurnSpeedMult:3},a=[],o=[];function s(){o=[];for(let n=0;n<i.foodCount;n++){let n,r=0;do n={x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:30},r++;while(u(n.x,n.y,n.r)&&r<100);o.push(n)}}function c(){a=[];for(let n=0;n<i.nestCount;n++){let r,i=0;do r=n===0&&i===0?{x:e/2,y:t/2,r:20}:{x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:20},i++;while(u(r.x,r.y,r.r)&&i<100);a.push(r)}}var l=[];function u(e,t,n){for(let r of l)if(e+n>r.x&&e-n<r.x+r.w&&t+n>r.y&&t-n<r.y+r.h)return!0;return!1}function d(){l=[];let n=Math.floor(e/60),r=Math.floor(t/60);l.push({x:0,y:0,w:e,h:10}),l.push({x:0,y:t-10,w:e,h:10}),l.push({x:0,y:0,w:10,h:t}),l.push({x:e-10,y:0,w:10,h:t});for(let e=2;e<r-1;e+=2)for(let t=2;t<n-1;t+=2){let n=t*60,r=e*60;switch(l.push({x:n,y:r,w:10,h:10}),Math.floor(Math.random()*4)){case 0:l.push({x:n,y:r-60,w:10,h:60});break;case 1:l.push({x:n,y:r,w:10,h:60});break;case 2:l.push({x:n-60,y:r,w:60,h:10});break;case 3:l.push({x:n,y:r,w:60,h:10});break}}}var f=class{width;height;homeGrid;foodGrid;constructor(e,t){this.width=e,this.height=t,this.homeGrid=new Float32Array(e*t),this.foodGrid=new Float32Array(e*t)}deposit(e,t,r,a){let o=Math.floor(t)*this.width+Math.floor(e);o>=0&&o<this.homeGrid.length&&((i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[o]=Math.min(1,this.homeGrid[o]+a):this.foodGrid[o]=Math.min(1,this.foodGrid[o]+a))}getLevel(e,t,r){if(e<0||e>=this.width||t<0||t>=this.height)return-1;let a=Math.floor(t)*this.width+Math.floor(e);return(i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[a]:this.foodGrid[a]}evaporate(e){for(let t=0;t<this.homeGrid.length;t++)this.homeGrid[t]*=e,this.foodGrid[t]*=e,this.homeGrid[t]<.001&&(this.homeGrid[t]=0),this.foodGrid[t]<.001&&(this.foodGrid[t]=0)}reset(){this.homeGrid.fill(0),this.foodGrid.fill(0)}},p=class{x;y;angle;state;pheromoneStrength;excitedLevel;constructor(e,t){this.x=e,this.y=t,this.angle=Math.random()*Math.PI*2,this.state=r.FORAGING,this.pheromoneStrength=1,this.excitedLevel=0}update(e,t){if(this.excitedLevel===1&&i.excitedDecayRate>0&&Math.random()<i.excitedDecayRate&&(this.excitedLevel=0),i.propagationChance>0&&this.excitedLevel===0){for(let e of t)if(e!==this&&e.excitedLevel===2&&Math.random()<i.propagationChance){this.excitedLevel=1;break}}this.sense(e);let r=this.excitedLevel>0?.05:.2;this.angle+=(Math.random()-.5)*r;let a=i.moveSpeed*(this.excitedLevel>0?i.excitedSpeedMult:1);if(i.explorationResistance>0){let t=Math.max(e.getLevel(this.x,this.y,n.HOME),e.getLevel(this.x,this.y,n.FOOD)),r=1-i.explorationResistance*(1-t);a*=Math.max(0,r)}let o=this.x,s=this.y;this.x+=Math.cos(this.angle)*a,this.y+=Math.sin(this.angle)*a,this.handleObstacles(o,s),this.handleBoundaries(e),this.handleStateAndPheromones(e)}handleObstacles(e,t){for(let n of l)if(this.x>=n.x&&this.x<=n.x+n.w&&this.y>=n.y&&this.y<=n.y+n.h){this.x=e,this.y=t,this.angle+=Math.PI+(Math.random()-.5);return}}sense(e){let t=this.state===r.FORAGING?n.FOOD:n.HOME,a=this.angle-i.sensorAngle,o=this.angle+i.sensorAngle,s=e=>({x:this.x+Math.cos(e)*i.sensorDist,y:this.y+Math.sin(e)*i.sensorDist}),c=s(a),l=s(this.angle),u=s(o),d=e.getLevel(c.x,c.y,t),f=e.getLevel(l.x,l.y,t),p=e.getLevel(u.x,u.y,t),m=i.turnSpeed;if(this.excitedLevel>0&&(m*=i.excitedTurnSpeedMult),f>d&&f>p||(f<d&&f<p?this.angle+=(Math.random()-.5)*2*m:d>p?this.angle-=m:p>d&&(this.angle+=m)),i.uTurnChance>0){let e=Math.random()<i.uTurnChance;f+Math.max(d,p)<.05&&Math.random()<i.uTurnChance*10&&(e=!0),e&&(this.angle+=Math.PI)}}handleBoundaries(e){this.x<0&&(this.x=0,this.angle=Math.PI-this.angle),this.x>=e.width&&(this.x=e.width-1,this.angle=Math.PI-this.angle),this.y<0&&(this.y=0,this.angle=-this.angle),this.y>=e.height&&(this.y=e.height-1,this.angle=-this.angle)}handleStateAndPheromones(e){let t=a[0],s=1/0;for(let e of a){let n=Math.hypot(this.x-e.x,this.y-e.y);n<s&&(s=n,t=e)}let c=s,l=t.r,u=!1;for(let e of o)if(Math.hypot(this.x-e.x,this.y-e.y)<e.r){u=!0;break}this.state===r.FORAGING?(e.deposit(this.x,this.y,n.HOME,this.pheromoneStrength),u?(this.state=r.RETURNING,this.pheromoneStrength=1,this.angle+=Math.PI,this.excitedLevel=2):i.usePheromoneGradient?this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005):this.pheromoneStrength=1,c<l&&(this.pheromoneStrength=1)):(e.deposit(this.x,this.y,n.FOOD,this.pheromoneStrength),c<l?(this.state=r.FORAGING,this.pheromoneStrength=1,this.angle+=Math.PI,this.excitedLevel=0):i.usePheromoneGradient?this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005):this.pheromoneStrength=1,u&&(this.pheromoneStrength=1))}},m=document.getElementById(`simCanvas`).getContext(`2d`,{alpha:!1}),h=new f(e,t),g=[];function _(){g=[]}function v(){let e=(e,t,n=!1)=>{let r=document.getElementById(e),a=document.getElementById(`val-${e}`);r.addEventListener(`input`,()=>{let e=n?parseFloat(r.value):parseInt(r.value);i[t]=e,a.textContent=String(e),t===`agentCount`&&(_(),h.reset())})};e(`agentCount`,`agentCount`),e(`moveSpeed`,`moveSpeed`,!0),e(`evapRate`,`evaporationRate`,!0),e(`sensorAngle`,`sensorAngle`,!1);let t=document.getElementById(`sensorAngle`),n=document.getElementById(`val-sensorAngle`);t.addEventListener(`input`,()=>{let e=parseFloat(t.value);i.sensorAngle=e*(Math.PI/180),n.textContent=String(e)}),e(`sensorDist`,`sensorDist`,!0),e(`uTurnChance`,`uTurnChance`,!0),e(`excitedSpeedMult`,`excitedSpeedMult`,!0),e(`propagationChance`,`propagationChance`,!0),e(`excitedDecayRate`,`excitedDecayRate`,!0),e(`explorationResistance`,`explorationResistance`,!0),e(`excitedTurnSpeedMult`,`excitedTurnSpeedMult`,!0),e(`nestCount`,`nestCount`,!1),document.getElementById(`nestCount`)?.addEventListener(`input`,()=>{c(),_(),h.reset()}),e(`foodCount`,`foodCount`,!1),document.getElementById(`foodCount`)?.addEventListener(`input`,()=>{s(),h.reset(),_()});let r=document.getElementById(`singlePheromoneMode`);r&&r.addEventListener(`change`,()=>{i.singlePheromoneMode=r.checked,h.reset(),_()});let a=document.getElementById(`usePheromoneGradient`);a&&a.addEventListener(`change`,()=>{i.usePheromoneGradient=a.checked,h.reset(),_()}),document.getElementById(`mazeBtn`)?.addEventListener(`click`,()=>{d(),h.reset(),c(),s(),_()}),document.getElementById(`clearMazeBtn`)?.addEventListener(`click`,()=>{l=[],h.reset(),c(),s(),_()}),document.getElementById(`resetBtn`)?.addEventListener(`click`,()=>{h.reset(),c(),s(),_()})}function y(){if(g.length<i.agentCount)for(let e=0;e<5&&!(g.length>=i.agentCount);e++){let e=a[Math.floor(Math.random()*a.length)];g.push(new p(e.x,e.y))}h.evaporate(i.evaporationRate);let n=Math.ceil(e/10),r=new Map;for(let e of g){let t=Math.floor(e.x/10),i=Math.floor(e.y/10)*n+t;r.has(i)||r.set(i,[]),r.get(i).push(e)}for(let e of g){let t=Math.floor(e.x/10),i=Math.floor(e.y/10)*n+t,a=r.get(i)||[];e.update(h,a)}let s=m.getImageData(0,0,e,t),c=s.data;for(let e=0;e<h.homeGrid.length;e++){let t=h.homeGrid[e],n=h.foodGrid[e],r=e*4;c[r]=Math.min(255,n*255*2),c[r+1]=Math.min(255,(t+n)*30),c[r+2]=Math.min(255,t*255*2),c[r+3]=255}for(let t of g){let n=Math.floor(t.x),r=(Math.floor(t.y)*e+n)*4;r>=0&&r<c.length&&(t.excitedLevel===2?(c[r]=255,c[r+1]=150,c[r+2]=50):t.excitedLevel===1?(c[r]=255,c[r+1]=255,c[r+2]=100):(c[r]=255,c[r+1]=255,c[r+2]=255),c[r+3]=255)}m.putImageData(s,0,0),m.strokeStyle=`rgba(100, 100, 255, 0.5)`,m.lineWidth=2;for(let e of a)m.beginPath(),m.arc(e.x,e.y,e.r,0,Math.PI*2),m.stroke();m.strokeStyle=`rgba(255, 100, 100, 0.5)`;for(let e of o)m.beginPath(),m.arc(e.x,e.y,e.r,0,Math.PI*2),m.stroke();m.fillStyle=`#888`;for(let e of l)m.fillRect(e.x,e.y,e.w,e.h);requestAnimationFrame(y)}v(),c(),s(),_();var b=document.getElementById(`sensorAngle`);i.sensorAngle=parseFloat(b.value)*(Math.PI/180),y();