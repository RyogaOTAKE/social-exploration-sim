(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e=600,t=600,n=function(e){return e[e.HOME=0]=`HOME`,e[e.FOOD=1]=`FOOD`,e}(n||{}),r=function(e){return e[e.FORAGING=0]=`FORAGING`,e[e.RETURNING=1]=`RETURNING`,e}(r||{}),i={agentCount:500,moveSpeed:1.5,evaporationRate:.985,sensorAngle:Math.PI/4,sensorDist:20,turnSpeed:.2,nestCount:1,foodCount:4,singlePheromoneMode:!1},a=[],o=[];function s(){o=[];for(let n=0;n<i.foodCount;n++)o.push({x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:30})}function c(){a=[];for(let n=0;n<i.nestCount;n++)n===0?a.push({x:e/2,y:t/2,r:20}):a.push({x:Math.random()*(e-100)+50,y:Math.random()*(t-100)+50,r:20})}var l=class{width;height;homeGrid;foodGrid;constructor(e,t){this.width=e,this.height=t,this.homeGrid=new Float32Array(e*t),this.foodGrid=new Float32Array(e*t)}deposit(e,t,r,a){let o=Math.floor(t)*this.width+Math.floor(e);o>=0&&o<this.homeGrid.length&&((i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[o]=Math.min(1,this.homeGrid[o]+a):this.foodGrid[o]=Math.min(1,this.foodGrid[o]+a))}getLevel(e,t,r){if(e<0||e>=this.width||t<0||t>=this.height)return-1;let a=Math.floor(t)*this.width+Math.floor(e);return(i.singlePheromoneMode?n.HOME:r)===n.HOME?this.homeGrid[a]:this.foodGrid[a]}evaporate(e){for(let t=0;t<this.homeGrid.length;t++)this.homeGrid[t]*=e,this.foodGrid[t]*=e,this.homeGrid[t]<.001&&(this.homeGrid[t]=0),this.foodGrid[t]<.001&&(this.foodGrid[t]=0)}reset(){this.homeGrid.fill(0),this.foodGrid.fill(0)}},u=class{x;y;angle;state;pheromoneStrength;constructor(e,t){this.x=e,this.y=t,this.angle=Math.random()*Math.PI*2,this.state=r.FORAGING,this.pheromoneStrength=1}update(e){this.sense(e),this.angle+=(Math.random()-.5)*.2,this.x+=Math.cos(this.angle)*i.moveSpeed,this.y+=Math.sin(this.angle)*i.moveSpeed,this.handleBoundaries(e),this.handleStateAndPheromones(e)}sense(e){let t=this.state===r.FORAGING?n.FOOD:n.HOME,a=this.angle-i.sensorAngle,o=this.angle+i.sensorAngle,s=e=>({x:this.x+Math.cos(e)*i.sensorDist,y:this.y+Math.sin(e)*i.sensorDist}),c=s(a),l=s(this.angle),u=s(o),d=e.getLevel(c.x,c.y,t),f=e.getLevel(l.x,l.y,t),p=e.getLevel(u.x,u.y,t);f>d&&f>p||(f<d&&f<p?this.angle+=(Math.random()-.5)*2*i.turnSpeed:d>p?this.angle-=i.turnSpeed:p>d&&(this.angle+=i.turnSpeed))}handleBoundaries(e){this.x<0&&(this.x=0,this.angle=Math.PI-this.angle),this.x>=e.width&&(this.x=e.width-1,this.angle=Math.PI-this.angle),this.y<0&&(this.y=0,this.angle=-this.angle),this.y>=e.height&&(this.y=e.height-1,this.angle=-this.angle)}handleStateAndPheromones(e){let t=a[0],i=1/0;for(let e of a){let n=Math.hypot(this.x-e.x,this.y-e.y);n<i&&(i=n,t=e)}let s=i,c=t.r,l=!1;for(let e of o)if(Math.hypot(this.x-e.x,this.y-e.y)<e.r){l=!0;break}this.state===r.FORAGING?(e.deposit(this.x,this.y,n.HOME,this.pheromoneStrength),l?(this.state=r.RETURNING,this.pheromoneStrength=1,this.angle+=Math.PI):this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005),s<c&&(this.pheromoneStrength=1)):(e.deposit(this.x,this.y,n.FOOD,this.pheromoneStrength),s<c?(this.state=r.FORAGING,this.pheromoneStrength=1,this.angle+=Math.PI):this.pheromoneStrength=Math.max(0,this.pheromoneStrength-.005),l&&(this.pheromoneStrength=1))}},d=document.getElementById(`simCanvas`).getContext(`2d`,{alpha:!1}),f=new l(e,t),p=[];function m(){p=[]}function h(){let e=(e,t,n=!1)=>{let r=document.getElementById(e),a=document.getElementById(`val-${e}`);r.addEventListener(`input`,()=>{let e=n?parseFloat(r.value):parseInt(r.value);i[t]=e,a.textContent=String(e),t===`agentCount`&&(m(),f.reset())})};e(`agentCount`,`agentCount`),e(`moveSpeed`,`moveSpeed`,!0),e(`evapRate`,`evaporationRate`,!0),e(`sensorAngle`,`sensorAngle`,!1);let t=document.getElementById(`sensorAngle`),n=document.getElementById(`val-sensorAngle`);t.addEventListener(`input`,()=>{let e=parseFloat(t.value);i.sensorAngle=e*(Math.PI/180),n.textContent=String(e)}),e(`sensorDist`,`sensorDist`,!0),e(`nestCount`,`nestCount`,!1),document.getElementById(`nestCount`)?.addEventListener(`input`,()=>{c(),m(),f.reset()}),e(`foodCount`,`foodCount`,!1),document.getElementById(`foodCount`)?.addEventListener(`input`,()=>{s(),f.reset(),m()});let r=document.getElementById(`singlePheromoneMode`);r&&r.addEventListener(`change`,()=>{i.singlePheromoneMode=r.checked,f.reset(),m()}),document.getElementById(`resetBtn`)?.addEventListener(`click`,()=>{f.reset(),c(),s(),m()})}function g(){if(p.length<i.agentCount)for(let e=0;e<5&&!(p.length>=i.agentCount);e++){let e=a[Math.floor(Math.random()*a.length)];p.push(new u(e.x,e.y))}f.evaporate(i.evaporationRate);for(let e of p)e.update(f);let n=d.getImageData(0,0,e,t),r=n.data;for(let e=0;e<f.homeGrid.length;e++){let t=f.homeGrid[e],n=f.foodGrid[e],i=e*4;r[i]=Math.min(255,n*255*2),r[i+1]=Math.min(255,(t+n)*30),r[i+2]=Math.min(255,t*255*2),r[i+3]=255}for(let t of p){let n=Math.floor(t.x),i=(Math.floor(t.y)*e+n)*4;i>=0&&i<r.length&&(r[i]=255,r[i+1]=255,r[i+2]=255)}d.putImageData(n,0,0),d.strokeStyle=`rgba(100, 100, 255, 0.5)`,d.lineWidth=2;for(let e of a)d.beginPath(),d.arc(e.x,e.y,e.r,0,Math.PI*2),d.stroke();d.strokeStyle=`rgba(255, 100, 100, 0.5)`;for(let e of o)d.beginPath(),d.arc(e.x,e.y,e.r,0,Math.PI*2),d.stroke();requestAnimationFrame(g)}h(),c(),s(),m();var _=document.getElementById(`sensorAngle`);i.sensorAngle=parseFloat(_.value)*(Math.PI/180),g();